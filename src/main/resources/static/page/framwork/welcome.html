<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>主页一</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
</head>
<style>
    .layui-top-box {
        padding: 40px 20px 20px 20px;
        color: #fff
    }

    .panel {
        margin-bottom: 17px;
        background-color: #fff;
        border: 1px solid transparent;
        border-radius: 3px;
        -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
        box-shadow: 0 1px 1px rgba(0, 0, 0, .05)
    }

    .panel-body {
        padding: 15px
    }

    .panel-title {
        margin-top: 0;
        margin-bottom: 0;
        font-size: 14px;
        color: inherit
    }

    .label {
        display: inline;
        padding: .2em .6em .3em;
        font-size: 75%;
        font-weight: 700;
        line-height: 1;
        color: #fff;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: .25em;
        margin-top: .3em;
    }

    .layui-red {
        color: red
    }

    .main_btn > p {
        height: 40px;
    }
</style>
<body>
<div class="layuimini-container">
    <div class="layuimini-main layui-top-box">
        <div class="layui-row layui-col-space10">

            <div class="layui-col-md3">
                <div class="col-xs-6 col-md-3">
                    <div class="panel layui-bg-cyan">
                        <div class="panel-body">
                            <div class="panel-title">
                                <span class="label pull-right layui-bg-blue">实时</span>
                                <h5>用户统计</h5>
                            </div>
                            <div class="panel-content">
                                <h1 class="no-margins">1234</h1>
                                <div class="stat-percent font-bold text-gray"><i class="fa fa-commenting"></i> 1234
                                </div>
                                <small>当前分类总记录数</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="layui-col-md3">
                <div class="col-xs-6 col-md-3">
                    <div class="panel layui-bg-blue">
                        <div class="panel-body">
                            <div class="panel-title">
                                <span class="label pull-right layui-bg-cyan">实时</span>
                                <h5>商品统计</h5>
                            </div>
                            <div class="panel-content">
                                <h1 class="no-margins">1234</h1>
                                <div class="stat-percent font-bold text-gray"><i class="fa fa-commenting"></i> 1234
                                </div>
                                <small>当前分类总记录数</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="layui-col-md3">
                <div class="col-xs-6 col-md-3">
                    <div class="panel layui-bg-green">
                        <div class="panel-body">
                            <div class="panel-title">
                                <span class="label pull-right layui-bg-orange">实时</span>
                                <h5>浏览统计</h5>
                            </div>
                            <div class="panel-content">
                                <h1 class="no-margins">1234</h1>
                                <div class="stat-percent font-bold text-gray"><i class="fa fa-commenting"></i> 1234
                                </div>
                                <small>当前分类总记录数</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-md3">
                <div class="col-xs-6 col-md-3">
                    <div class="panel layui-bg-orange">
                        <div class="panel-body">
                            <div class="panel-title">
                                <span class="label pull-right layui-bg-green">实时</span>
                                <h5>订单统计</h5>
                            </div>
                            <div class="panel-content">
                                <h1 class="no-margins">1234</h1>
                                <div class="stat-percent font-bold text-gray"><i class="fa fa-commenting"></i> 1234
                                </div>
                                <small>当前分类总记录数</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-box">
        <div class="layui-row layui-col-space10">
            <div class="layui-col-md12">
                <blockquote class="layui-elem-quote main_btn">
                    <p>本模板基于layui2.5.4以及font-awesome-4.7.0进行实现。layui开发文档地址：<a
                            class="layui-btn layui-btn-xs layui-btn-danger" target="_blank"
                            href="http://www.layui.com/doc">layui文档</a></p>
                    <p>技术交流QQ群（561838086）：<a target="_blank" href="https://jq.qq.com/?_wv=1027&k=5JRGVfe"><img
                            border="0" src="//pub.idqqimg.com/wpa/images/group.png" alt="layuimini"
                            title="layuimini"></a>（加群请备注来源：如gitee、github、官网等）</p>
                    <p>喜欢此后台模板的可以给我的GitHub和Gitee加个Star支持一下</p>
                    <p>GitHub地址：
                        <iframe src="https://ghbtns.com/github-btn.html?user=zhongshaofa&repo=layuimini&type=star&count=true"
                                frameborder="0" scrolling="0" width="100px" height="20px"></iframe>
                        <iframe src="https://ghbtns.com/github-btn.html?user=zhongshaofa&repo=layuimini&type=fork&count=true"
                                frameborder="0" scrolling="0" width="100px" height="20px"></iframe>
                    </p>
                    <p>Gitee地址：<a href="https://gitee.com/zhongshaofa/layuimini" target="_blank"><img
                            src="https://gitee.com/zhongshaofa/layuimini/badge/star.svg?theme=dark" alt="star"></a> <a
                            href="https://gitee.com/zhongshaofa/layuimini" target="_blank"><img
                            src="https://gitee.com/zhongshaofa/layuimini/badge/fork.svg?theme=dark" alt="fork"></a></p>
                </blockquote>
            </div>
        </div>
    </div>

    <div class="layui-box">
        <div class="layui-row layui-col-space10">
            <div class="layui-col-md6">
                <p style="margin: 0 auto">维修记录</p>
                <table class="layui-table">
                    <colgroup>
                        <col width="150">
                        <col width="200">
                        <col>
                    </colgroup>
                    <thead>
                    <tr>
                        <th>楼号</th>
                        <th>房间号</th>
                        <th>申请时间</th>
                        <th>原因</th>
                    </tr>
                    </thead>
                    <tbody id="repairRecords">
                    <!-- 动态生成的维修记录 -->
                    </tbody>
                </table>
            </div>
            <div class="layui-col-md6">
                <p style="margin: 0 auto">违纪记录</p>
                <ul class="layui-timeline" id="disciplineTimeline">
                    <!-- 违纪记录会动态插入到这里 -->
                </ul>
            </div>
        </div>
    </div>
</div>
<script src="../../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="../../lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
<script>
    $(document).ready(function () {

        // 发送 AJAX 请求获取维修记录
        $.ajax({
            url: '/api/fix', // 后端接口地址
            method: 'GET',
            success: function (response) {
                var repairRecords = response.data; // 提取 data 属性
                var html = '';

                // 遍历数据并生成表格行
                repairRecords.forEach(function (record) {
                    html += '<tr>';
                    html += '<td>' + record.bno + '</td>'; // 楼号
                    html += '<td>' + record.frno + '</td>'; // 房间号
                    html += '<td>' + record.fstart + '</td>'; // 申请时间
                    html += '<td>' + record.freason + '</td>'; // 原因
                    html += '</tr>';
                });

                // 将生成的表格行插入到表格中
                $('#repairRecords').html(html);
            },
            error: function (error) {
                console.error('请求失败:', error);
                layer.msg('加载维修记录失败', {icon: 2});
            }
        });
        $.ajax({
            url: '/api/discipline/recent',  // 后端接口 URL
            type: 'GET',  // 请求方式
            success: function (data) {
                if (data.success) {
                    const records = data.data;
                    const timeline = $('#disciplineTimeline');
                    timeline.empty();  // 清空之前的记录

                    // 遍历每一条记录并添加到时间轴
                    records.forEach(record => {
                        const timelineItem = $('<li>').addClass('layui-timeline-item');

                        const axis = $('<i>').addClass('layui-icon layui-timeline-axis').html('&#xe63f;');

                        const content = $('<div>').addClass('layui-timeline-content layui-text');

                        const title = $('<h3>').addClass('layui-timeline-title').text(record.dtime);

                        const reason = $('<p>').html(`
                        <strong>违纪人：</strong> ${record.sname} <br>
                        <strong>专业：</strong> ${record.major} <br>
                        <strong>违纪原因：</strong> ${record.dreason} <br>
                        <strong>处罚：</strong> ${record.dpanish} <br>
                    `);

                        // 将内容添加到时间轴项目中
                        content.append(title).append(reason);
                        timelineItem.append(axis).append(content);
                        timeline.append(timelineItem);  // 添加到时间轴
                    });
                } else {
                    console.error('获取最近三天的违纪记录失败');
                }
            },
            error: function (xhr, status, error) {
                console.error('请求错误：', error);
            }
        });
    });
</script>
</body>
</html>